var Be=Object.defineProperty;var ze=(t,s,n)=>s in t?Be(t,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[s]=n;var X=(t,s,n)=>ze(t,typeof s!="symbol"?s+"":s,n);import{q as Q,u as B,j as e,Q as We,a as O,b as ee,c as Ge,R as Ye}from"./tanstack-BjdLQ5hw.js";import{c as Qe,r as i,u as W,L as Z,f as Ve,R as ae,O as ye,h as He,i as Je,j as Xe,k as Ke}from"./react-Dm8snE5z.js";import{c as Ze,i as et}from"./supabase-7q-5WrAP.js";import{d as z,F as p,A as je,I,B as h,a as c,s as A,T as N,R as tt,b as ke,D as st,U as K,c as we,e as ve,M as ie,f as le,g as nt,h as be,i as at,P as Ie,j as rt,k as ot,l as it,m as lt,n as Te,o as ct,p as dt,q as ut,r as mt,t as q,u as pt,v as ht,w as gt,x as ft,y as xt,z as ce,C as yt,E as jt,G as kt,H as wt,J as vt,K as bt,L as It,N as Tt,O as St,Q as Se,S as de,V as Ct}from"./ant-CV4Q-UGq.js";import{R as Et,B as Ft,C as Rt,X as Pt,Y as $t,T as Ot,a as Lt,L as At}from"./recharts-B-HRoCR9.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const d of o.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&a(d)}).observe(document,{childList:!0,subtree:!0});function n(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(r){if(r.ep)return;r.ep=!0;const o=n(r);fetch(r.href,o)}})();var Ce,ue=Qe;Ce=ue.createRoot,ue.hydrateRoot;var Nt={items_per_page:"/ стр.",jump_to:"Перейти",jump_to_confirm:"подтвердить",page:"Страница",prev_page:"Назад",next_page:"Вперед",prev_5:"Предыдущие 5",next_5:"Следующие 5",prev_3:"Предыдущие 3",next_3:"Следующие 3",page_size:"размер страницы"},_t={locale:"ru_RU",today:"Сегодня",now:"Сейчас",backToToday:"Текущая дата",ok:"ОК",clear:"Очистить",month:"Месяц",year:"Год",timeSelect:"Выбрать время",dateSelect:"Выбрать дату",monthSelect:"Выбрать месяц",yearSelect:"Выбрать год",decadeSelect:"Выбрать десятилетие",yearFormat:"YYYY",dateFormat:"D-M-YYYY",dayFormat:"D",dateTimeFormat:"D-M-YYYY HH:mm:ss",monthBeforeYear:!0,previousMonth:"Предыдущий месяц (PageUp)",nextMonth:"Следующий месяц (PageDown)",previousYear:"Предыдущий год (Control + left)",nextYear:"Следующий год (Control + right)",previousDecade:"Предыдущее десятилетие",nextDecade:"Следущее десятилетие",previousCentury:"Предыдущий век",nextCentury:"Следующий век"};const Ee={placeholder:"Выберите время",rangePlaceholder:["Время начала","Время окончания"]},me={lang:Object.assign({placeholder:"Выберите дату",yearPlaceholder:"Выберите год",quarterPlaceholder:"Выберите квартал",monthPlaceholder:"Выберите месяц",weekPlaceholder:"Выберите неделю",rangePlaceholder:["Начальная дата","Конечная дата"],rangeYearPlaceholder:["Начальный год","Год окончания"],rangeMonthPlaceholder:["Начальный месяц","Конечный месяц"],rangeWeekPlaceholder:["Начальная неделя","Конечная неделя"],shortWeekDays:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"],shortMonths:["Янв","Фев","Мар","Апр","Май","Июн","Июл","Авг","Сен","Окт","Ноя","Дек"]},_t),timePickerLocale:Object.assign({},Ee)},L="${label} не является типом ${type}",Ut={locale:"ru",Pagination:Nt,DatePicker:me,TimePicker:Ee,Calendar:me,global:{placeholder:"Пожалуйста выберите"},Table:{filterTitle:"Фильтр",filterConfirm:"OK",filterReset:"Сбросить",filterEmptyText:"Без фильтров",filterCheckall:"Выбрать все элементы",filterSearchPlaceholder:"Поиск в фильтрах",emptyText:"Нет данных",selectAll:"Выбрать всё",selectInvert:"Инвертировать выбор",selectNone:"Очистить все данные",selectionAll:"Выбрать все данные",sortTitle:"Сортировка",expand:"Развернуть строку",collapse:"Свернуть строку",triggerDesc:"Нажмите для сортировки по убыванию",triggerAsc:"Нажмите для сортировки по возрастанию",cancelSort:"Нажмите, чтобы отменить сортировку"},Tour:{Next:"Далее",Previous:"Назад",Finish:"Завершить"},Modal:{okText:"OK",cancelText:"Отмена",justOkText:"OK"},Popconfirm:{okText:"OK",cancelText:"Отмена"},Transfer:{titles:["",""],searchPlaceholder:"Поиск",itemUnit:"элем.",itemsUnit:"элем.",remove:"Удалить",selectAll:"Выбрать все данные",selectCurrent:"Выбрать текущую страницу",selectInvert:"Инвертировать выбор",removeAll:"Удалить все данные",removeCurrent:"Удалить текущую страницу"},Upload:{uploading:"Загрузка...",removeFile:"Удалить файл",uploadError:"При загрузке произошла ошибка",previewFile:"Предпросмотр файла",downloadFile:"Загрузить файл"},Empty:{description:"Нет данных"},Icon:{icon:"иконка"},Text:{edit:"Редактировать",copy:"Копировать",copied:"Скопировано",expand:"Раскрыть"},Form:{optional:"(необязательно)",defaultValidateMessages:{default:"Ошибка проверки поля ${label}",required:"Пожалуйста, введите ${label}",enum:"${label} должен быть одним из [${enum}]",whitespace:"${label} не может быть пустым",date:{format:"${label} не правильный формат даты",parse:"${label} не может быть преобразовано в дату",invalid:"${label} не является корректной датой"},types:{string:L,method:L,array:L,object:L,number:L,date:L,boolean:L,integer:L,float:L,regexp:L,email:L,url:L,hex:L},string:{len:"${label} должна быть ${len} символов",min:"${label} должна быть больше или равна ${min} символов",max:"${label} должна быть меньше или равна ${max} символов",range:"Длина ${label} должна быть между ${min}-${max} символами"},number:{len:"${label} должна быть равна ${len}",min:"${label} должна быть больше или равна ${min}",max:"${label} должна быть меньше или равна ${max}",range:"${label} должна быть между ${min}-${max}"},array:{len:"Количество элементов ${label} должно быть равно ${len}",min:"Количество элементов ${label} должно быть больше или равно ${min}",max:"Количество элементов ${label} должно быть меньше или равно ${max}",range:"Количество элементов ${label} должно быть между ${min} и ${max}"},pattern:{mismatch:"${label} не соответствует шаблону ${pattern}"}}},Image:{preview:"Предпросмотр"},QRCode:{expired:"QR-код устарел",refresh:"Обновить"}},D={user:"user",userAvatar:"userAvatar",checkLogin:"checkLogin",attachments:"attachments",attachmentsUrl:"attachmentsUrl",tasks:"tasks",completedTasks:"completedTasks",taskTypes:"taskTypes"};class C{constructor(s){X(this,"name");X(this,"message");X(this,"code");this.message=s.message,this.name=s.name,s.code&&(this.code=s.code)}}const v=Ze("https://bezykkplqcrsoettxmqn.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJlenlra3BscWNyc29ldHR4bXFuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTAzMzUxMTUsImV4cCI6MjAyNTkxMTExNX0.vxAZ78i4fJs8x3WYn9W_vxxTMz8DiQuJngbP_upuz40"),J=t=>{if(t instanceof Error)throw new C(t);if(t!=null&&t.code)throw console.log("DataProvider?.checkApiError",t),t},Dt=t=>Q({queryKey:[D.checkLogin,t],queryFn:async({queryKey:s,signal:n})=>{console.log("signal",n);const{data:a,error:r}=await v.from("users").select().eq("login",s[1]).abortSignal(n);if(r)throw new C({message:r.message,name:"Не удалось проверить логин"});return!!a.length}}),Mt=async t=>{const{data:s,error:n}=await v.from("users").update(t).eq("id",t.id).select();if(n)throw new C({message:n.message,name:"Не удалось обновить данные пользователя"});if(s)return s[0]},qt=t=>Q({queryKey:[D.user,t],queryFn:async({queryKey:s,signal:n})=>{const{data:a,error:r}=await v.from("users").select().eq("id",s[1]).abortSignal(n);if(r)throw new C({message:r.message,name:"Не удалось получить данные пользователя"});return a[0]},enabled:!!t}),re={checkLogin:Dt,updateUserInfo:Mt,getUserById:qt},Bt=t=>Q({queryKey:[D.attachments,t],queryFn:async({signal:s,queryKey:n})=>{const{data:a,error:r}=await v.from("attachments").select().eq("id",n[1]).abortSignal(s);if(r)throw new C({name:"Не удалось получить вложения",message:`${r.code}: ${r.message}`});return a[0]},select:s=>({fullPath:s.full_path,id:s.id,path:s.path,publicUrl:s.public_url}),enabled:!!t}),zt=async(t,s)=>{const{error:n}=await v.from("attachments").delete().eq("id",t.id);if(n)throw new C({name:"Не удалось удалить вложения",message:`${n.code}: ${n.message}`});const{error:a}=await v.storage.from(s).remove([t.path]);if(a)throw new C({name:"Не удалось удалить файл из хранилища",message:`${a.name}: ${a.message}`})},Wt=async(t,s)=>{const{data:n,error:a}=await v.storage.from(s).upload(t.name,t);if(a)throw new C({name:"Не удалось сохранить вложения",message:`${a.name}: ${a.message}`});const{data:{publicUrl:r}}=v.storage.from(s).getPublicUrl(n.path);console.log("uploadedFile",n);const{error:o}=await v.from("attachments").insert([{id:n.id,path:n.path,full_path:n.fullPath,public_url:r||null}]).select();if(o)throw new C({name:"Не удалось получить вложения",message:`${o.code}: ${o.message}`});return{...n,publicUrl:r}},oe={getAttachmentById:Bt,deleteAttachment:zt,saveAttachment:Wt},pe="sb-bezykkplqcrsoettxmqn-auth-token",Fe=i.createContext({user:null,isAuthCheking:!0,isUserLoading:!1,setUserId:()=>{},logOut:()=>{}}),Gt=({children:t})=>{const[s,n]=i.useState(null),[a,r]=i.useState(!0),{data:o=null,isFetching:d}=B({...re.getUserById(s),refetchOnWindowFocus:!1}),{data:u=null}=B({...oe.getAttachmentById(o==null?void 0:o.avatar_id)}),m=()=>{localStorage.removeItem(pe),n(null)};i.useEffect(()=>{const y=localStorage.getItem(pe);if(!y){r(!1);return}const{user:b}=JSON.parse(y);b.id&&(n(b.id),r(!1))},[]),i.useEffect(()=>{o&&!a&&r(!1)},[o,a]);const T=i.useMemo(()=>o?{...o,avatar:u||null}:null,[o,u]);return e.jsx(Fe.Provider,{value:{user:T,isAuthCheking:a,setUserId:n,isUserLoading:d,logOut:m},children:t})},Yt=new We,Qt={cssVar:!0,token:{fontSize:16,colorBgLayout:"none",colorLink:"#7CB2B0",colorBorder:"#D2D7E3",colorTextPlaceholder:"var(--gray-5)"},components:{Layout:{siderBg:"#CDE1E1"},Input:{colorBgBase:"none",colorBgContainer:"none",fontSize:16,borderRadius:0},Typography:{titleMarginBottom:"none",titleMarginTop:"none"},Upload:{colorInfoText:"var(--gray-5)"}}},E={REQUIRED:"Поле обязательно",PASSWORD_DUPLICATE:"Пароли должны совпадать",MIN_LENGTH:t=>`Минимальная длина ${t} символов`,MAX_LENGTH:t=>`Максимальная длина ${t} символов`,CYRILLIC:"Недопустимые символы,только кирилица"},Vt=14,Ht=z().subtract(Vt,"year"),Jt=z(),he=5,ge=25,Xt="Логин уже занят",S={SIGN_IN:"/sign-in",SIGN_UP:"/sign-up",RESET_PASSWORD:"/reset-password",UPDATE_PASSWORD:"/update-password",BASE:"/",USER:"/user",CHECK_LOGIN:"/check-login",STATISTIC:"/statistic",TASKS:"/tasks",LOGOUT:"/logout",INFO:"/info"},Kt="http://localhost:5173/update-password",Zt=async({email:t,password:s})=>{const{data:n,error:a}=await v.auth.signInWithPassword({email:t,password:s});return J(a),n},es=async({email:t,password:s})=>{const{data:n,error:a}=await v.auth.signUp({email:t,password:s});if(et(a))throw new C({name:"Недопустимый пароль",message:a.message});J(a);const{data:r,error:o}=await v.from("users").upsert({id:n.user.id,login:n.user.email,email:n.user.email});return J(o),r},ts=async t=>{const{data:s,error:n}=await v.auth.resetPasswordForEmail(t,{redirectTo:Kt});return J(n),s},ss=async t=>{const{data:s,error:n}=await v.auth.updateUser({password:t});return J(n),s},te={signIn:Zt,signUp:es,resetPassword:ts,updatePassword:ss},M=()=>i.useContext(Fe),fe=()=>{const{setUserId:t}=M(),s=W(),n=O({mutationFn:te.signIn,onSuccess:r=>{t(r.user.id),s(S.BASE)}}),a=r=>{n.mutate({email:r.email,password:r.password})};return e.jsxs(e.Fragment,{children:[e.jsxs(p,{name:"sign-in",layout:"vertical",style:{width:"100%"},onFinish:a,children:[!!n.error&&e.jsx(je,{message:n.error.message||"",type:"error"}),e.jsx(p.Item,{name:"email",label:"Почта пользователя",rules:[{required:!0,message:E.REQUIRED}],children:e.jsx(I,{size:"large",type:"email"})}),e.jsx(p.Item,{name:"password",label:"Пароль",rules:[{required:!0,message:E.REQUIRED}],children:e.jsx(I.Password,{size:"large",type:"password"})}),e.jsx(p.Item,{style:{textAlign:"center"},children:e.jsx(h,{type:"primary",htmlType:"submit",block:!0,size:"large",loading:n.isPending,children:"Войти"})})]}),e.jsxs(c,{className:"sign-in-actions",align:"center",justify:"space-between",children:[e.jsx(Z,{to:S.RESET_PASSWORD,children:"Забыли пароль ?"}),e.jsx(Z,{to:S.SIGN_UP,children:"Регистрация"})]})]})},ns=()=>{const t=W(),s=Ve(),n=O({mutationFn:te.signUp,onSuccess:()=>{A.success("Вы успешно зарегестрированы войдите в систему"),t(S.BASE)}});return e.jsxs(p,{layout:"vertical",style:{width:"100%"},onFinish:n.mutate,disabled:n.isPending,children:[!!n.error&&e.jsx(je,{style:{margin:"10px 0"},message:s.message||"",type:"error"}),e.jsx(p.Item,{name:"email",label:"Почта",rules:[{required:!0,message:E.REQUIRED}],children:e.jsx(I,{size:"large",type:"email"})}),e.jsx(p.Item,{name:"password",label:"Пароль",rules:[{required:!0,message:E.REQUIRED}],children:e.jsx(I.Password,{size:"large",type:"password"})}),e.jsx(p.Item,{name:"passwordRepeat",dependencies:["password"],label:"Повторите пароль",rules:[{required:!0,message:E.REQUIRED},({getFieldValue:a})=>({validator(r,o){return!o||a("password")===o?Promise.resolve():Promise.reject(new Error(E.PASSWORD_DUPLICATE))}})],children:e.jsx(I.Password,{size:"large",type:"password"})}),e.jsx(p.Item,{style:{textAlign:"center"},children:e.jsx(h,{type:"primary",htmlType:"submit",block:!0,size:"large",loading:n.isPending,children:"Зарегестрироваться"})}),e.jsx(c,{align:"center",justify:"center",children:e.jsx(Z,{to:S.SIGN_IN,children:"К форме аторизации"})})]})},as=()=>{const t=O({mutationFn:te.resetPassword,onSuccess:()=>{A.success("Письмо отправлено на почту")}});return console.log("resetPasswordMutation.data",t.data),e.jsxs(e.Fragment,{children:[t.data?e.jsx(N.Title,{level:2,style:{textAlign:"center",marginBottom:"1rem"},children:"Письмо отправлено на email"}):e.jsxs(p,{name:"sign-in",layout:"vertical",style:{width:"100%"},onFinish:({email:s})=>t.mutate(s),children:[e.jsx(p.Item,{name:"email",label:"Почта пользователя",rules:[{required:!0,message:E.REQUIRED}],children:e.jsx(I,{size:"large",type:"email"})}),e.jsx(p.Item,{style:{textAlign:"center"},children:e.jsx(h,{type:"primary",htmlType:"submit",block:!0,size:"large",loading:t.isPending,children:"Сбросить пароль"})})]}),e.jsx(c,{align:"center",justify:"center",children:e.jsx(Z,{to:S.SIGN_IN,children:"К форме аторизации"})})]})},rs=(t,s)=>{const n=new FileReader;n.addEventListener("load",()=>s(n.result)),n.readAsDataURL(t)},Re=t=>{const s=t.type==="image/jpeg"||t.type==="image/png";if(!s)return"Загрузить можно только файлы в формате: jpeg, png";const n=t.size/1024/1024<2;return n?s&&n:"Файл должен быть меньше 2MB"},os="DD.MM.YYYY",is=1e3,Pe=60*is,$e=(t,s)=>{if(t===s)return!0;if(typeof t!="object"&&typeof t!="function"||typeof s!="object"&&typeof s!="function")return!1;if(t===null||s===null)return t===s;const n=Object.keys(t),a=Object.keys(s);if(n.length!==a.length)return!1;for(let r of n)if(!a.includes(r)||!$e(t[r],s[r]))return!1;return!0},ls=()=>{const{user:t}=M(),s=ee(),[n,a]=i.useState(!1),[r,o]=i.useState(null),[d,u]=i.useState(!1),[m]=p.useForm(),T=i.useRef(cs),y=O({mutationFn:x=>re.updateUserInfo({...x,id:t.id}),onSuccess:(x,R)=>{s.setQueryData([D.user,t==null?void 0:t.id],{...t,...R})}}),b=O({mutationFn:async x=>oe.deleteAttachment(x,"avatar")}),j=O({mutationFn:async x=>oe.saveAttachment(x,"avatar")});i.useEffect(()=>{var x;T.current={login:(t==null?void 0:t.login)||"",birthday:z(t==null?void 0:t.birthdate),surname:(t==null?void 0:t.surname)||"",name:(t==null?void 0:t.name)||"",patronymic:(t==null?void 0:t.patronymic)||"",avatar:(t==null?void 0:t.avatar)||null},(x=t==null?void 0:t.avatar)!=null&&x.publicUrl&&o(t.avatar.publicUrl),m.setFieldsValue(T.current)},[t,m]);const k=async(x,R)=>{if(R===(t==null?void 0:t.login))return Promise.resolve();try{return await s.fetchQuery(re.checkLogin(R))?Promise.reject(Xt):Promise.resolve()}catch{return Promise.reject("При проверке логина произошла ошибка")}},g=x=>{u(!$e(x,T.current))},l=({file:x})=>{x&&(a(!0),m.setFieldValue("avatar",x),rs(x,R=>{a(!1),o(R)}))},f=()=>{m.setFieldValue("avatar",""),o(null),u(!0)},F=m.getFieldsError().filter(({errors:x})=>x.length).length>0,V=async()=>{const x=t==null?void 0:t.avatar,R=m.getFieldValue("avatar");return x&&(R instanceof File||!R)&&await b.mutateAsync(x),R instanceof File?await j.mutateAsync(R):null};return{isAvatarLoading:n,checkDirty:g,avatarUrl:r,isFormDirty:d,form:m,updateUser:async x=>{const{avatar:R,...w}=x;let _;return R!==(t==null?void 0:t.avatar)?_=await V():_=(t==null?void 0:t.avatar)||null,y.mutate({...w,avatar_id:(_==null?void 0:_.id)||null})},handleChangeAvatar:l,deleteAvatar:f,checkLogin:k,updateAvatar:V,hasErrors:F,isFormSubmitting:y.isPending||j.isPending||b.isPending}},cs={login:"",birthday:null,surname:"",name:"",patronymic:"",avatar:null},{confirm:ds}=ie,us=({onCancel:t})=>{const{form:s,updateUser:n,checkDirty:a,isAvatarLoading:r,avatarUrl:o,isFormDirty:d,handleChangeAvatar:u,deleteAvatar:m,checkLogin:T,isFormSubmitting:y}=ls(),b=l=>{n(l).then(()=>{A.success("Данные успешно сохранены"),t()}).catch(()=>{A.error("Ошибка при сохранении данных")})},j=e.jsx(h,{style:{border:0,background:"none"},type:"text",children:e.jsx(c,{vertical:!0,align:"center",justify:"center",children:r?e.jsx(tt,{}):e.jsxs(N.Paragraph,{type:"secondary",style:{marginTop:8},children:[e.jsx(ke,{style:{color:"var(--gray-7)"}})," Загрузить"]})})}),k=()=>{d?ds({title:"Закрыть окно ?",content:"Несохраненные изменения будут утеряны.",okText:"Да",cancelText:"Нет",onOk:t}):t()},g=l=>{const f=Re(l),F=typeof f!="string";return F||A.error(f),F};return e.jsxs(p,{onFinish:b,labelAlign:"left",layout:"vertical",labelWrap:!0,disabled:y,form:s,onValuesChange:(l,f)=>a(f),size:"large",style:{position:"relative",maxWidth:"600px"},children:[e.jsxs(c,{align:"center",children:[e.jsxs(c,{vertical:!0,flex:1,children:[e.jsx(p.Item,{label:"Логин",name:"login",wrapperCol:{span:22},validateTrigger:["onBlur","onChange"],validateFirst:!0,rules:[{required:!0,message:E.REQUIRED},{min:he,message:E.MIN_LENGTH(he)},{max:ge,message:E.MAX_LENGTH(ge)},{validateTrigger:["onBlur"],validator:T}],children:e.jsx(I,{placeholder:"LUKA"})}),e.jsx(p.Item,{label:"Дата рождения",name:"birthday",wrapperCol:{span:22},rules:[{required:!0,message:E.REQUIRED,type:"date"}],children:e.jsx(st,{style:{width:"100%"},placeholder:"06.06.0006",format:os,maxDate:Jt,minDate:Ht})})]}),e.jsxs(p.Item,{name:"avatar",valuePropName:"fileList[0]",style:{position:"relative"},children:[e.jsx(K,{className:"person-form-upload",name:"avatar",listType:"picture-card",showUploadList:!1,beforeUpload:g,customRequest:u,disabled:!!o,children:o?e.jsx("div",{style:{margin:"4px",borderRadius:"4px",overflow:"hidden"},children:e.jsx(we,{height:140,style:{objectFit:"cover"},src:o,preview:{toolbarRender:()=>null}})}):j}),o&&e.jsx(h,{style:{position:"absolute",bottom:-32,right:0},type:"text",size:"small",onClick:m,icon:e.jsx(ve,{})})]})]}),e.jsx(p.Item,{label:"Фамилия",name:"surname",rules:[{pattern:/^[\s\u0400-\u04FF]+$/,message:E.CYRILLIC}],children:e.jsx(I,{placeholder:"Лукавый"})}),e.jsx(p.Item,{label:"Имя",name:"name",rules:[{pattern:/^[\s\u0400-\u04FF]+$/,message:E.CYRILLIC}],children:e.jsx(I,{placeholder:"Лука"})}),e.jsx(p.Item,{label:"Отчество",name:"patronymic",rules:[{pattern:/^[\s\u0400-\u04FF]+$/,message:E.CYRILLIC}],children:e.jsx(I,{placeholder:"Лукич"})}),e.jsxs(c,{gap:16,justify:"end",children:[e.jsx(h,{type:"primary",htmlType:"submit",disabled:!d,children:"Сохранить"}),e.jsx(h,{type:"default",onClick:k,children:"Отмена"})]})]})};function ms({hideContainer:t}){var o;const[s,n]=i.useState(!1),{user:a}=M(),r=()=>{t(),n(!0)};return e.jsxs(le.Ribbon,{text:e.jsx(N,{children:"Новичок"}),children:[e.jsxs(c,{vertical:!0,gap:16,className:"acc-container",children:[e.jsxs(c,{gap:16,children:[e.jsx(nt,{shape:"square",size:64,gap:8,src:(o=a==null?void 0:a.avatar)==null?void 0:o.publicUrl,icon:e.jsx(be,{})}),e.jsxs(c,{vertical:!0,gap:16,children:[e.jsx(N,{children:a==null?void 0:a.login}),e.jsx(N,{children:a==null?void 0:a.email}),e.jsx(N,{children:[a==null?void 0:a.surname,a==null?void 0:a.name].filter(Boolean).join(" ")})]})]}),e.jsx(h,{className:"acc-edit-button",icon:e.jsx(at,{}),size:"large",type:"text",onClick:r})]}),e.jsx(ie,{open:s,closable:!1,footer:null,centered:!0,destroyOnClose:!0,title:"Реадктирование данных профиля",children:e.jsx(us,{onCancel:()=>{n(!1)}})})]})}const ps=()=>{const{logOut:t}=M(),[s,n]=i.useState(!1);return e.jsxs(c,{justify:"space-between",className:"menu-wrapper",align:"center",children:[e.jsxs("div",{className:"user-button-wrapper",children:[e.jsx(h,{type:"text",icon:e.jsx(be,{size:24}),onClick:()=>n(!0)}),e.jsx(Ie,{placement:"bottomLeft",content:e.jsx(ms,{hideContainer:()=>n(!1)}),overlayInnerStyle:{padding:0},arrow:!1,open:s,trigger:"click",onOpenChange:a=>n(a),children:e.jsx("div",{className:"menu-point-popover"})})]}),e.jsx(c,{children:e.jsx(h,{type:"text",icon:e.jsx(rt,{size:24}),title:"Выход",onClick:t})})]})},hs={name:"",email:"",messubject:"",description:""},gs=({close:t,isOpen:s})=>{const[n]=p.useForm(),[a,r]=ae.useState([]),[o,d]=ae.useState(""),[u,m]=ae.useState(!1),T=O({mutationFn:fs,onSuccess:()=>{A.success("Обращение успешно отправлено"),n.resetFields(),r([]),t()},onError:()=>{A.error("Не удалось отправить обращение")}}),y=l=>{const f=Re(l);return console.log("result",f),typeof f=="string"?(A.error(f+":"+l.name),K.LIST_IGNORE):!0},b=({file:l})=>{console.log("handleUploadChange",a),r([...a,l])},j=async l=>{console.log("handlePreview",l),!l.url&&!l.preview&&l.originFileObj&&(l.preview=URL.createObjectURL(l.originFileObj)),d(l.url||l.preview||URL.createObjectURL(l)),m(!0)},k=l=>{const f={...l,attachments:a.map(F=>F.originFileObj).filter(Boolean)};T.mutate(f)},g=()=>{d(""),r([]),t()};return e.jsx(ie,{title:"Форма обратной связи",open:s,onCancel:g,destroyOnClose:!0,footer:null,className:"feed-back-modal",children:e.jsxs(p,{name:"feedback_form",layout:"vertical",onFinish:k,form:n,initialValues:hs,size:"large",children:[e.jsxs(c,{justify:"space-between",gap:16,children:[e.jsxs(c,{vertical:!0,flex:1,children:[e.jsx(p.Item,{label:"Имя",name:"name",rules:[{required:!0}],children:e.jsx(I,{})}),e.jsx(p.Item,{label:"Email",name:"email",validateTrigger:["onBlur"],rules:[{required:!0,message:""},{required:!0,type:"email",message:"Введен некоретный email"}],children:e.jsx(I,{})}),e.jsx(p.Item,{label:"Тема",name:"subject",rules:[{required:!0,message:"Введите тему"},{min:6,message:"Тема должна быть не менее 6 символов"}],children:e.jsx(I,{})})]}),e.jsx(c,{flex:1,children:e.jsx(p.Item,{style:{width:"100%"},label:"Описание",name:"description",rules:[{required:!0,message:"Введите описание"},{min:10,message:"Описание должно быть не менее 10 символов"}],children:e.jsx("div",{style:{position:"relative"},children:e.jsx(I.TextArea,{rows:7,style:{resize:"none",paddingBottom:40}})})})})]}),a.length>0&&e.jsx(K,{fileList:a,className:"feedback-attachments",onRemove:l=>{const f=a.indexOf(l),F=a.slice();F.splice(f,1),r(F)},onPreview:j,listType:"text"}),o&&e.jsx(we,{style:{display:"none",height:0},src:o,preview:{visible:u,onVisibleChange:l=>m(l),destroyOnClose:!0,toolbarRender:()=>null}}),e.jsxs(c,{children:[e.jsx(K,{beforeUpload:y,fileList:a,multiple:!0,maxCount:5,accept:".jpeg,.jpg,.png",showUploadList:!1,customRequest:b,children:e.jsx(h,{icon:e.jsx(ke,{}),type:"text"})}),e.jsxs(c,{style:{marginLeft:"auto"},gap:8,children:[e.jsx(h,{onClick:g,children:"Отмена"}),e.jsx(h,{type:"primary",htmlType:"submit",loading:T.isPending,children:"Отправить"})]})]})]})})},fs=async t=>(console.log("sendFeedback",t),await new Promise(s=>setTimeout(s,1e3)),Math.random()>.3?Promise.resolve():Promise.reject(new Error("Ошибка сервера"))),xs=()=>{const[t,s]=i.useState(!1),n=W();return e.jsxs(c,{justify:"space-between",className:"footer-wrapper",align:"center",children:[e.jsxs(c,{gap:"0.5rem",children:[e.jsx(h,{type:"text",icon:e.jsx(ot,{size:24}),title:"Статистика",onClick:()=>{n(S.STATISTIC)}}),e.jsx(h,{icon:e.jsx(it,{size:24}),onClick:()=>n(S.INFO),type:"text",title:"О приложении"}),e.jsx(h,{icon:e.jsx(lt,{size:24}),onClick:()=>s(!0),type:"text"})]}),e.jsx(N.Link,{style:{paddingRight:"0.4rem"},children:" gladk0ff"}),e.jsx(gs,{close:()=>s(!1),isOpen:t})]})},ys=()=>e.jsxs("div",{className:"main-layout",children:[e.jsx(ps,{}),e.jsx(ye,{}),e.jsx(xs,{})]});var $=(t=>(t.active="active",t.complete="complete",t.new="new",t))($||{});const js=()=>Q({queryKey:[D.taskTypes],queryFn:async({signal:t})=>{const{data:s,error:n}=await v.from("task_types").select("*").abortSignal(t);if(n)throw new C({name:"Не удалось получить типы задач",message:`${n.code}: ${n.message}`});return s}}),ks=t=>Q({queryKey:[D.tasks,t],queryFn:async({signal:s,queryKey:n})=>{const{data:a,error:r}=await v.from("tasks").select("*").eq("author_id",n[1]).abortSignal(s);if(r)throw new C({name:"Не удалось список задач",message:`${r.code}: ${r.message}`});return a}}),ws=(t,s)=>Q({queryKey:[D.completedTasks,t,s],queryFn:async({signal:n,queryKey:a})=>{const r=v.from("tasks").select("*").eq("author_id",a[1]).eq("status_id",$.complete).order("created_at",{ascending:!1});s&&r.eq("type_id",s);const{data:o,error:d}=await r.abortSignal(n);if(d)throw new C({name:"Не удалось список задач",message:`${d.code}: ${d.message}`});return o}}),vs=async({authorId:t,task:s,taskStatus:n,typeId:a})=>{const{data:r,error:o}=await v.from("tasks").insert({author_id:t,type_id:a,text:s,status_id:n}).select();if(o)throw new C({name:"Не удалось создать задачу",message:`${o.code}: ${o.message}`});return r[0]},bs=async t=>{const{error:s}=await v.from("tasks").delete().eq("id",t);if(s)throw new C({name:"Не удалось удалить задачу",message:`${s.code}: ${s.message}`});return t},Is=async({id:t,...s})=>{const{data:n,error:a}=await v.from("tasks").update({...s}).eq("id",t).select();if(a)throw new C({name:"Не удалось обновить задачу",message:`${a.code}: ${a.message}`});return n[0]},Ts=async t=>{const{error:s}=await v.from("tasks").update({status_id:"complete"}).eq("author_id",t).eq("done",!0).neq("status_id","complete").lt("created_at",z().startOf("day").format("YYYY-MM-DD"));if(s)throw new C({name:"Не удалость изменить статус задач на завершенные",message:`${s.code}: ${s.message}`})},Ss=async t=>{const{error:s}=await v.from("tasks").update({created_at:z().toISOString(),important:!0}).eq("author_id",t).eq("status_id",$.active).or("done.is.null,done.eq.false").lt("created_at",z().startOf("day").format("YYYY-MM-DD"));if(s)throw new C({name:"Не удалость изменить статус задач на завершенные",message:`${s.code}: ${s.message}`})},U={getTaskTypes:js,getUserTasks:ks,getUserCompletedTasks:ws,createTask:vs,deleteTask:bs,updateTask:Is,setTasksToComplete:Ts,updateActiveTaskDate:Ss};var P=(t=>(t.soul="soul",t.health="health",t.social="social",t.life="life",t.growth="growth",t.mind="mind",t.rest="rest",t))(P||{});const Cs=()=>{const{user:t}=M(),[s,n]=i.useState(!1),[a,r]=i.useState(),o=i.useMemo(()=>(t==null?void 0:t.id)||"",[t==null?void 0:t.id]),{mutate:d}=O({mutationFn:j=>U.setTasksToComplete(j),onSuccess:()=>{n(!0)}}),{mutate:u}=O({mutationFn:j=>U.updateActiveTaskDate(j)}),{data:m,isLoading:T}=B({...U.getTaskTypes(),refetchOnWindowFocus:!1,refetchOnMount:!1}),{data:y=[],isLoading:b}=B({...U.getUserTasks(o),refetchIntervalInBackground:!0,refetchInterval:5*Pe,refetchOnWindowFocus:!1,enabled:!!s});return i.useEffect(()=>{o&&!s&&(d(o),u(o))},[o,s,d,u]),i.useEffect(()=>{if(!(m!=null&&m.length))return;const j={};m.forEach(k=>{j[k.id]||(j[k.id]={data:[],stats:{inWork:0,done:0},label:k.title})}),y.forEach(k=>{j[k.type_id].data.push(k),k.status_id===$.active&&(j[k.type_id].stats.inWork+=1,k.done&&(j[k.type_id].stats.done+=1))}),r(j)},[y,m]),{taskTypesIsLoading:T,taskTypes:m,userTasks:y,userTasksIsLoading:b,taskGroups:a,userId:o}};function Es(t,s){const[n,a]=i.useState(t);return i.useEffect(()=>{const r=setTimeout(()=>{a(t)},s);return()=>{clearTimeout(r)}},[t,s]),n}const Fs=({task:t,isChangeStateBlock:s})=>{const{done:n,priority:a=0}=t,[r,o]=i.useState(t.text),d=i.useRef(!1),u=i.useRef(null),m=Es(r,700),T=ee(),{user:y}=M(),b=O({mutationFn:U.deleteTask,onSuccess:w=>{T.setQueryData([D.tasks,y.id],_=>_==null?void 0:_.filter(G=>G.id!==w))}}),{mutate:j,isPending:k}=O({mutationFn:U.updateTask,onSuccess:w=>{T.setQueryData([D.tasks,y.id],_=>{const G=[..._??[]],ne=G.findIndex(qe=>qe.id===w.id);return ne!==-1&&(G[ne]={...G[ne],...w}),[...G]})}}),g=()=>{b.mutate(t.id,{onError:w=>{A.error(w.message)}})},l=i.useCallback(w=>{console.log("updateTask",w),j(w)},[j]),f=w=>{w.stopPropagation(),d.current=!1,l({...t,done:!t.done})},F=()=>{l({...t,important:!t.important})},V=()=>{l({...t,status_id:t.status_id===$.active?$.new:$.active,done:!1,created_at:new Date().toISOString()})},se=b.isPending||k,x=t.important?ct:dt;i.useEffect(()=>{var w;d.current&&((w=u.current)==null||w.focus()),t.text!==m&&l({...t,text:m})},[m,t,l]);const R=()=>{switch(t.status_id){case $.active:return e.jsx(I,{ref:u,className:q("task-input",!!a&&`task-input--prioriry-${a}`,{"task-input--done":!!n,"task-input--has-prioriry ":!!a,"task-input--important ":!!t.important}),onFocus:()=>{d.current=!0},onBlur:()=>{d.current=!1},value:r,disabled:se,onChange:w=>{o(w.target.value)},prefix:e.jsx(h,{icon:e.jsx(pt,{className:q("task-icon-check-online",n&&"task-icon-check-online--checked")}),type:"text",onClick:f}),suffix:e.jsxs(c,{className:"task-input-actions",justify:"end",children:[e.jsx(h,{icon:e.jsx(x,{}),type:"text",onClick:F}),e.jsx(h,{icon:e.jsx(Te,{}),type:"text"}),e.jsx(h,{icon:e.jsx(ht,{}),onClick:V,type:"text"}),e.jsx(h,{disabled:b.isPending,className:"action-delete",icon:e.jsx(ve,{}),onClick:g,type:"text"})]})});case $.new:return e.jsx(I,{className:"task-input",value:r,disabled:se,onChange:w=>{o(w.target.value)},prefix:e.jsx(h,{icon:e.jsx(ut,{}),disabled:s,onClick:V,type:"text"}),suffix:e.jsx(h,{icon:e.jsx(mt,{}),onClick:g,type:"text"})})}};return e.jsx(c,{justify:"space-between",align:"center",gap:16,children:R()})},Rs=({text:t,author_id:s,type_id:n,created_at:a})=>{const r=ee(),o=O({mutationFn:U.createTask}),d=()=>{o.mutate({authorId:s,task:t,taskStatus:$.new,typeId:n},{onSuccess:async()=>{await r.invalidateQueries({queryKey:[D.tasks,s]}),A.success("Задача добавлена в 'Запланированные' ")}})};return e.jsx(c,{justify:"space-between",align:"center",gap:16,className:"task-completed-row",children:e.jsx(I,{className:"task-input",value:t,readOnly:!0,prefix:e.jsx("span",{children:z(a).format("DD.MM")}),suffix:e.jsx(h,{onClick:d,icon:e.jsx(Te,{}),shape:"circle",type:"text",loading:o.isPending})})})},Ps=()=>e.jsxs("p",{children:["Привет! ",e.jsx("br",{}),"Данное приложение создано, как плод работы моих мыслей по поводу нашего бренного прибывания! ",e.jsx("br",{}),"- Кто я? Чего делаю и зачем ? В чем смысл?",e.jsx("br",{}),"- Насколько я близок с Богом?",e.jsx("br",{}),"- Что нужно делать? Как правильно двигаться? ",e.jsx("br",{}),"- Что я хочу и куда стремлюсь? ",e.jsx("br",{}),"- Что я делаю для развития? Доволен ли я результатом своих действий ?",e.jsx("br",{}),"- Что является движущий силой для меня?",e.jsx("br",{}),e.jsx("br",{}),"Если мысли эти Тебе чужды то возможно это приложение, которое создано впервую очередь как помошник мне в собственной жизни - не подойдет Тебе, в этом нет ничего страшного - значит у Тебя свой путь - ищи его ! и Удачи Тебе! Если в чем-то вопросы совпадают или Ты понимаешь ход моих мыслей, то читай далее... Аксимома - Принял тот факт, что ответом на все вопросы у меня нет, сей час точно, а может и не будет никогда...",e.jsx("br",{}),"Факт 1 - жизнь идет несмотря на то , нашел ли я ответы или нет и с этим надо что-то делать",e.jsx("br",{}),"Факт 2 - мне почему-то ничего не хочется, может потому что очень долго был зависимым или в базовой комплектации со мной что-то не так - суть имеем что имеем",e.jsx("br",{}),"Вывод - выделить оснонвые группы дел (как мне кажется) в течении жизни, которые спосоствуют гармоничному развитию личности (опять же по-моему мнению) чтобы двигаться по ним пока идет поиск ответов на вопросы, что ранее перечислил...",e.jsx("br",{}),"Итог: Созданы 7+1 направление (+1 потому то одну категорию - из опыта, надо включить позже, когда освоишься с системой и она войдет в Твою жизнь) которые надо сделать привычками(привычками потому что Факт2 - ничего не хочется=) ), это разовьет дисциплину, в дисциплина это всего хорошо. это всегда Сила Воли",e.jsx("br",{}),"Категории, что я выделил: Здоровье, Духовное-нравственное развитие, Взаимодействие с социумом, Развитие интеллеката, Бытовые дела, Развитие проффесиональное, Отдых (порядок - просто перечисление, не содержит приоретиацию)"]}),Oe=()=>e.jsxs(e.Fragment,{children:[e.jsx("h2",{children:"Ежедневная забота о теле – основа всего."}),e.jsx("p",{children:"Утренняя зарядка, прогулка, питьевой режим, здоровый сон и питание дают энергию, укрепляют иммунитет и повышают стрессоустойчивость, позволяя эффективно справляться с любыми задачами."}),e.jsx("p",{children:"Например для меня, это стакан воды в день, утренняя зарядка с обливаниями, три раза в неделю упражнения\\бег, упражнения для глаз."})]}),Le=()=>e.jsxs(e.Fragment,{children:[e.jsx("h2",{children:"Социальные коммуникации."}),e.jsx("h3",{children:"Общение – фундамент эмоционального благополучия."}),e.jsx("p",{children:"Короткий разговор с близким, обед с коллегой или вежливый диалог с соседом поддерживают связи, дарят чувство принадлежности, помогают решать вопросы и снимают напряжение, делая жизнь насыщеннее.."}),e.jsx("p",{children:"Например для меня, это провести время с Семьей или позвонить Отцу, Брату, навестить Маму на работе, позвонить с другом."})]}),Ae=()=>e.jsxs(e.Fragment,{children:[e.jsx("h2",{children:" Духовно-нравственная воспитание"}),e.jsxs("p",{children:["Сюда я вынес все то с чем мы сталиваемся в поисках ответов на след вопросы:",e.jsx("br",{}),"Кто я? Есть ли Бог? Быть или не быть? Что для меня важно и во что я верю и т.д.",e.jsx("br",{}),"Слово это все то, что помогает Вам познать себя, мир вокруг Вас от бесконечно малого во внутрь, до бесконечно большого во вне"]}),e.jsx("p",{children:"Работа над этим необходимо, как мне кажется, чтобы обрести некий фундамент осознанности в поступках и убеждений"}),e.jsxs("p",{children:["Не буду углублять в какую-то философию или религизность - это Ваше личное дело, Ваш личный путь...",e.jsx("br",{}),"Как пример: лично для меня сюда вошли утренние и вечерние молитвы, работа по 12 шаговой программе, дыхательные упражнения"]})]}),Ne=()=>e.jsxs(e.Fragment,{children:[e.jsx("h2",{children:"Домашние дела."}),e.jsx("h3",{children:"Порядок вокруг создает порядок внутри."}),e.jsx("p",{children:"Быстрая уборка, мытье посуды, приготовление еды или раскладывание вещей по местам поддерживают комфортную среду, экономят время в будущем, снижают хаос и стресс, освобождая голову для важного."}),e.jsx("p",{children:"Например для меня, это все домашние дела которые могут возникнуть от поменять лампочки и наточить ножи до сделать навес над верандой, распечтать документы, оплатить домен, словом обычные бытовые дела которые должны быть сделаны."})]}),_e=()=>e.jsxs(e.Fragment,{children:[e.jsx("h2",{children:"Личностное-Профессиональное развитие"}),e.jsx("h3",{children:"Постоянное движение вперед – залог роста"}),e.jsx("p",{children:"Чтение профессиональной статьи, изучение нового навыка, планирование карьеры или работа над личными качествами (например, тайм-менеджмент) повышают компетентность, уверенность, открывают новые возможности и предотвращают застой."}),e.jsx("p",{children:"Например для меня, это чтение статьи по профессиональной сфере, создание этого и других приложений, подготовка докладов"})]}),Ue=()=>e.jsxs(e.Fragment,{children:[e.jsx("h2",{children:"Интеллектуальные упражнения"}),e.jsx("h3",{children:"Тренировка для ума сохраняет его остроту"}),e.jsx("p",{children:"Разгадывание кроссворда, изучение иностранных слов, анализ прочитанного, решение логических задач или игра в шахматы стимулируют мозг, улучшают память, концентрацию и гибкость мышления, помогая находить нестандартные решения."}),e.jsx("p",{children:"Например для меня, это разгадывание судоку, филвордов, игры в го, решение задач на алгоритмы"})]}),De=()=>e.jsxs(e.Fragment,{children:[e.jsx("h2",{children:"Время для себя"}),e.jsx("h3",{children:"Перезагрузка необходима для продуктивности."}),e.jsx("p",{children:". Сознательное безделье, любимое хобби, медитация, теплая ванна или просто тишина позволяют телу и психике восстановиться, предотвращают выгорание, восполняют ресурсы и дарят радость, делая остальное время более качественным."}),e.jsx("p",{children:"Например для меня, это просмотр мультиков, сериалов порой рисование - тут если честно мне трудно но в пути"})]}),Y={soul:{id:P.soul,title:"Дух",icon:gt,info:Ae},health:{id:P.health,title:"Здоровье",icon:ft,info:Oe},social:{id:P.social,title:"Социум",icon:xt,info:Le},life:{id:P.life,title:"Быт",icon:ce,info:Ne},growth:{id:P.growth,title:"Развитие",icon:yt,info:_e},mind:{id:P.mind,title:"Интеллект",icon:jt,info:Ue},rest:{id:P.rest,title:"Отдых",icon:kt,info:De}},$s=Object.keys(Y).map(t=>Y[t]),xe=({title:t,total:s=0,complite:n=0,tasks:a,taskStatus:r,typeId:o,hasUndoneImportant:d})=>{const[u,m]=i.useState(!1),T=ee(),[y]=p.useForm(),{user:b}=M(),{mutate:j,isPending:k}=O({mutationFn:async f=>await U.createTask(f),onSuccess(f){T.setQueryData([D.tasks,b.id],F=>[...F,f])}}),g=r===$.active,l=({task:f})=>{j({task:f,taskStatus:r,typeId:o,authorId:b.id},{onError:F=>{A.error(F.name)},onSuccess:async()=>{y.resetFields()}})};return e.jsxs(c,{vertical:!0,className:q({"task-fields-group":!0,"task-fields-group--active":g}),children:[e.jsxs(c,{justify:"space-between",children:[e.jsxs(N.Text,{type:g?"warning":"success",style:{color:g?"var(--ant-color-warning)":"var(--ant-color-success)"},children:[t,":"]}),e.jsx(le,{count:n?`${n}/${s}`:s,className:q({"task-fields-group-badge":!0,"task-fields-group-badge--active":g})})]}),e.jsx(p,{onFinish:l,form:y,className:"task-fields-group-form",children:e.jsx(p.Item,{noStyle:!0,name:"task",children:e.jsx(c,{onClick:()=>m(!0),onBlur:()=>m(!1),children:e.jsx(I,{disabled:k||r==$.active&&d,className:q("task-input","task-input-create",g&&"task-input-create--active"),placeholder:u?"":"Создать задачу",prefix:u?e.jsx(wt,{style:{fontSize:16}}):e.jsx(vt,{})})})})}),e.jsx("div",{className:"task-fields-group-content",children:a.map(f=>e.jsx(Fs,{task:f,isChangeStateBlock:r==$.new&&d},f.id))})]})},Os=({active:t=!1,tasks:s=[],type:n,userId:a})=>{const[r,o]=i.useState(!1),{data:d=[],isFetching:u}=B({...U.getUserCompletedTasks(a,n),enabled:r});if(i.useEffect(()=>{!t&&r&&o(!1)},[t,r]),!t||!n)return;const m=Y[n],T=m.info,{activeTasks:y=[],newTasks:b=[]}=s.reduce((g,l)=>(l.status_id==="new"&&g.newTasks.push(l),l.status_id==="active"&&g.activeTasks.push(l),g),{newTasks:[],activeTasks:[]}),j=y.filter(({done:g})=>g).length,k=y.some(({important:g,done:l})=>g&&!l);return e.jsxs(c,{className:"task-type-panel",vertical:!0,align:"start",gap:8,children:[e.jsxs(c,{className:"task-type-panel__content",vertical:!0,flex:1,children:[e.jsx(xe,{title:"В работе",complite:j,total:y.length,hasUndoneImportant:k,taskStatus:$.active,tasks:y,typeId:n}),e.jsx(bt,{className:"task-type-panel__divider",children:e.jsxs("div",{className:"task-type-panel__float-buttons",children:[m&&e.jsx(Ie,{getPopupContainer:()=>document.querySelector(".task-type-panel")||document.body,content:e.jsx(T,{}),title:"Разяснение в помощь о текуших задач",children:e.jsx(h,{icon:e.jsx(It,{size:24}),type:"link"})}),e.jsx(h,{icon:r?e.jsx(Tt,{}):e.jsx(St,{}),title:"Показать выполненные",type:"link",onClick:g=>{g.stopPropagation(),o(!r)}})]})}),e.jsx(xe,{title:"Запланированы",hasUndoneImportant:k,total:b.length,taskStatus:$.new,tasks:b,typeId:n})]}),e.jsx(Se,{className:"tasks-completed-drawer",title:e.jsxs(e.Fragment,{children:[e.jsx(N.Text,{type:"secondary",children:" Завершенные задачи : "}),e.jsx(le,{count:d.length||"0_-",color:"cyan"})]}),onClose:g=>{g.stopPropagation(),o(!1)},mask:!1,open:r,styles:{mask:{background:"none"},header:{padding:"0.5rem 1rem"},body:{padding:"0.5rem 1rem",height:"100%",background:"var(--gray-2)"}},children:e.jsx(c,{vertical:!0,gap:16,className:"tasks-completed-wrapper",children:e.jsx(de,{spinning:u,size:"large",children:d.map((g,l)=>i.createElement(Rs,{...g,key:l}))})})})]})},Ls=({stats:t,onClick:s,active:n=!1,id:a,title:r})=>{console.log(t);const o=Y[a].icon||null;return e.jsxs(c,{className:q({"task-type-container":!0,"task-type-container--active":n}),onClick:d=>{d.stopPropagation(),s==null||s(a)},children:[o&&e.jsx(o,{style:{fontSize:32}}),e.jsxs(c,{vertical:!0,children:[e.jsx(N.Title,{level:3,children:r}),e.jsxs(c,{style:{fontSize:"14px",lineHeight:1.2},gap:16,className:"task-type__stats",children:[e.jsxs("span",{style:{textDecoration:"underline"},children:["Сделано: ",t.done]}),e.jsxs("span",{children:["В работе: ",t.inWork]})]})]})]})},As=()=>{const[t,s]=i.useState(null),n=W(),{taskGroups:a,userTasksIsLoading:r,userId:o}=Cs(),d=u=>{s(t===u?null:u)};return e.jsxs(e.Fragment,{children:[e.jsx(c,{className:"task-page-content",onClick:()=>{s(null)},children:e.jsx(de,{spinning:r,children:e.jsx(c,{className:q("tasks-types-container",{"tasks-types-container--active":t}),children:a&&Object.keys(a).map(u=>e.jsx(Ls,{active:t===u,title:a[u].label,id:u,onClick:d,stats:a[u].stats},u))})})}),e.jsx(Se,{className:q("tasks-page-sider ",!t&&"tasks-page-sider--collapsed"),open:!!t,closable:!1,mask:!1,push:!1,getContainer:()=>document.querySelector(".task-page-content")||document.body,classNames:{wrapper:"tasks-page-sider-wrapper"},children:e.jsx(Os,{tasks:t?a[t].data:[],active:!!t,type:t,closeForm:()=>n(S.BASE),userId:o},t)})]})},Ns=t=>i.createElement("svg",{width:"143.49536mm",height:"122.80552mm",viewBox:"0 0 143.49536 122.80552",id:"svg5",xmlnsXlink:"http://www.w3.org/1999/xlink",xmlns:"http://www.w3.org/2000/svg","xmlns:svg":"http://www.w3.org/2000/svg",...t},i.createElement("defs",{id:"defs2"}),i.createElement("g",{id:"layer1",transform:"translate(-45.930734,-34.912509)"},i.createElement("g",{id:"g2544",transform:"translate(-0.87950327)"},i.createElement("text",{xmlSpace:"preserve",style:{fontSize:"61.9697px",lineHeight:.4,fontFamily:"Bahnschrift",InkscapeFontSpecification:"Bahnschrift",fill:"#4c47f7",stroke:"#000000",strokeWidth:0,strokeLinecap:"round",strokeLinejoin:"round",strokeDasharray:"none",strokeDashoffset:1.05827,paintOrder:"fill markers stroke"},x:62.63818,y:118.4164,id:"text236"},i.createElement("tspan",{id:"tspan234",style:{fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",fontStretch:"normal",fontFamily:"'Lucida Console'",InkscapeFontSpecification:"'Lucida Console'",fill:"#000000",fillOpacity:1,strokeWidth:0,strokeDasharray:"none"},x:62.63818,y:118.4164},i.createElement("tspan",{style:{fill:"#8c8c8c",fillOpacity:1},id:"tspan3600"},"4"),"0")),i.createElement("text",{xmlSpace:"preserve",style:{fontSize:"61.9697px",lineHeight:.4,fontFamily:"Bahnschrift",InkscapeFontSpecification:"Bahnschrift",fill:"#4c47f7",stroke:"#000000",strokeWidth:0,strokeLinecap:"round",strokeLinejoin:"round",strokeDasharray:"none",strokeDashoffset:1.05827,paintOrder:"fill markers stroke"},x:-174.00565,y:118.4164,id:"text236-6",transform:"scale(-1,1)"},i.createElement("tspan",{id:"tspan234-5",style:{fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",fontStretch:"normal",fontFamily:"'Lucida Console'",InkscapeFontSpecification:"'Lucida Console'",fill:"#8c8c8c",fillOpacity:1,strokeWidth:0,strokeDasharray:"none"},x:-174.00565,y:118.4164},"4"))),i.createElement("text",{xmlSpace:"preserve",style:{fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",fontStretch:"normal",fontSize:"9.87778px",lineHeight:.4,fontFamily:"'Lucida Console'",InkscapeFontSpecification:"'Lucida Console'",letterSpacing:0,wordSpacing:0,fill:"#000000",fillOpacity:1,stroke:"none",strokeWidth:.4,strokeLinecap:"round",strokeLinejoin:"round",strokeDasharray:"none",strokeDashoffset:1.05827,paintOrder:"fill markers stroke"},id:"text2152",transform:"rotate(-1.438715,-401.31432,179.37148)"},i.createElement("textPath",{xlinkHref:"#path2399",id:"textPath2502",style:{fontSize:"9.87778px"}},i.createElement("tspan",{id:"tspan2150",style:{fontSize:"9.87778px",strokeWidth:.4},dx:0,dy:0,rotate:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0"},"страница не найдена"))),i.createElement("path",{style:{fill:"none",fillOpacity:1,stroke:"#000000",strokeWidth:0,strokeLinecap:"round",strokeLinejoin:"round",strokeDasharray:"none",strokeDashoffset:1.05827,strokeOpacity:1,paintOrder:"fill markers stroke"},d:"m 65.040689,139.41204 c 38.596841,20.35488 72.893801,19.78702 104.803441,0 v 0.17068",id:"path2399"}),i.createElement("ellipse",{style:{fill:"none",fillOpacity:1,stroke:"#8c8c8c",strokeWidth:.924746,strokeLinecap:"round",strokeLinejoin:"round",strokeDasharray:"none",strokeDashoffset:1.05827,strokeOpacity:1,paintOrder:"fill markers stroke"},id:"path2548",cx:117.67841,cy:96.315277,rx:71.285309,ry:60.940395}))),_s=()=>{const t=W();return e.jsxs(c,{align:"center",justify:"center",style:{position:"relative",width:"100%",height:"100%"},children:[e.jsx(h,{type:"text",icon:e.jsx(ce,{}),style:{position:"absolute",left:"0.2rem",top:"0.2rem"},title:"На главную",onClick:()=>{t(S.BASE)}}),e.jsx(Ns,{})]})},Us=()=>e.jsx(c,{className:"auth-layout-container",vertical:!0,gap:"middle",align:"center",justify:"center",children:e.jsxs(c,{className:"auth-layout-content",vertical:!0,align:"center",justify:"center",children:[e.jsx("h1",{children:"7S"}),e.jsx(ye,{})]})}),Ds=t=>{const{x:s,y:n,payload:a}=t,r=Y[a.value].icon;return e.jsx("g",{transform:`translate(${s},${n})`,children:e.jsx("foreignObject",{x:-30,y:-12,width:24,height:24,children:e.jsx("div",{style:{width:"24px",height:"24px",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(r,{})})})})},Ms=({active:t,payload:s})=>{var a;const n=(a=s==null?void 0:s[0])==null?void 0:a.payload;return t&&n?e.jsx("div",{className:"custom-tooltip",style:{backgroundColor:"white",padding:"10px",border:"1px solid #ccc",borderRadius:"4px"},children:e.jsx("p",{children:`${Y[n.type].title}: ${s[0].value}`})}):null},qs=({data:t})=>e.jsx(Et,{width:"100%",height:"100%",children:e.jsxs(Ft,{data:t,layout:"vertical",children:[e.jsx(Rt,{strokeDasharray:"30 25"}),e.jsx(Pt,{type:"number",hide:!0}),e.jsx($t,{type:"category",dataKey:"type",tick:Ds}),e.jsx(Ot,{content:e.jsx(Ms,{})}),e.jsx(Lt,{dataKey:"value",fill:"#8884d8",radius:[0,4,4,0],children:e.jsx(At,{dataKey:"value",position:"insideRight",fill:"var(--gray-4)",fontSize:18,fontWeight:"bold"})})]})}),Bs=t=>{const{data:s=[],isLoading:n}=B({...U.getTaskTypes(),refetchOnWindowFocus:!1,refetchOnMount:!1}),{data:a=[],isLoading:r}=B({...U.getUserCompletedTasks(t),refetchIntervalInBackground:!0,refetchInterval:5*Pe,refetchOnWindowFocus:!1,enabled:!!t}),o=i.useMemo(()=>{const u={};return s.length&&s.forEach(m=>{u[m.id]||(u[m.id]=0)}),a.forEach(m=>{++u[m.type_id]}),u},[a,s]),d=Math.max(...Object.values(o))||7;return{taskTypes:s,userTasks:a,taskTypesIsLoading:n,userTasksIsLoading:r,taskGroupStats:o,maxPower:d}},{Title:zs}=N,Me=()=>{const t=W(),n=He().reduce((a,r,o)=>{var d,u;return(d=r.handle)!=null&&d.title&&a.push(e.jsx(zs,{level:4,children:(u=r.handle)==null?void 0:u.title},o)),a},[]);return e.jsxs(c,{gap:8,align:"center",style:{borderBottom:"1px solid var(--gray-5)",paddingBottom:"0.2rem",minHeight:"fit-content"},children:[e.jsx(h,{type:"text",icon:e.jsx(ce,{}),onClick:()=>{t(S.BASE)}}),n]})},Ws=()=>{const{user:t}=M(),{taskGroupStats:s,maxPower:n}=Bs(t.id),a=Object.keys(s).length?Object.entries(s).map(([r,o])=>({type:r,value:o,fullMark:n})):[];return e.jsxs(c,{vertical:!0,flex:1,style:{height:"100%",width:"100%",padding:"0.2rem"},children:[e.jsx(Me,{}),e.jsx(qs,{data:a})]})},Gs=()=>{const t=W(),s=O({mutationFn:n=>te.updatePassword(n),onSuccess:()=>{A.info("Пароль успешно обновлен"),t(S.SIGN_IN)},onError:n=>{A.error(n.message||"Произошла ошибка при обновлении пароля. Попробуйте позже или обратитесь к администратору")}});return e.jsxs(p,{name:"sign-in",layout:"vertical",style:{width:"100%"},onFinish:({password:n})=>s.mutate(n),children:[e.jsx(p.Item,{name:"password",label:"Новый пароль",rules:[{required:!0,message:E.REQUIRED}],children:e.jsx(I.Password,{size:"large",type:"password"})}),e.jsx(p.Item,{name:"passwordRepeat",dependencies:["password"],label:"Повторите пароль",rules:[{required:!0,message:E.REQUIRED},({getFieldValue:n})=>({validator(a,r){return!r||n("password")===r?Promise.resolve():Promise.reject(new Error(E.PASSWORD_DUPLICATE))}})],children:e.jsx(I.Password,{size:"large",type:"password"})}),e.jsx(p.Item,{style:{textAlign:"center"},children:e.jsx(h,{type:"primary",htmlType:"submit",block:!0,size:"large",loading:s.isPending,children:"Обновить пароль"})})]})},Ys=()=>{const[t,s]=i.useState(null),n=r=>()=>{s(o=>o&&o.id===r.id?null:r)},a=t!=null&&t.info?Qs[t.id]:Ps;return e.jsxs(c,{vertical:!0,className:"info-page-wrapper",children:[e.jsx(Me,{}),e.jsxs(c,{className:"info-page-content-container",children:[e.jsx(c,{gap:8,className:"info-page-buttons",vertical:!0,children:$s.map(r=>{const o=r.icon;return o?e.jsx(h,{type:"text",className:(t==null?void 0:t.id)===r.id?"info-page-button-active":"",icon:e.jsx(o,{}),title:r.title,onClick:n(r)},r.id):null})}),e.jsx(c,{className:"info-page-content-wrapper",justify:"center",children:e.jsxs(c,{className:"info-page-content",vertical:!0,gap:8,children:[e.jsx(N.Title,{level:1,children:(t==null?void 0:t.title)||"Зачем приложение нужно"}),a&&e.jsx(a,{})]})})]})]})},Qs={[P.soul]:Ae,[P.growth]:_e,[P.health]:Oe,[P.life]:Ne,[P.mind]:Ue,[P.rest]:De,[P.social]:Le},Vs=[{Component:Us,children:[{index:!0,Component:fe},{path:S.SIGN_IN,Component:fe},{path:S.SIGN_UP,Component:ns},{path:S.RESET_PASSWORD,Component:as},{path:S.UPDATE_PASSWORD,Component:Gs},{path:"*",loader:()=>Je("/")}]}],Hs=[{Component:ys,children:[{index:!0,Component:As},{path:S.STATISTIC,Component:Ws,handle:{title:"Статистика"}},{path:S.INFO,Component:Ys,handle:{title:"О Приложении"}},{path:"*",Component:_s}]}],Js=()=>{const{isAuthCheking:t,user:s,isUserLoading:n}=M();if(i.useEffect(()=>{function r(){const o=window.visualViewport?window.visualViewport.height:window.innerHeight;document.documentElement.style.setProperty("--app-height",`${o}px`)}return window.addEventListener("resize",r),window.addEventListener("orientationchange",r),r(),()=>{window.removeEventListener("resize",r),window.removeEventListener("orientationchange",r)}},[]),t||n)return e.jsx(de,{fullscreen:!0});const a=Xe(s!=null&&s.id?Hs:Vs);return e.jsx(Ke,{router:a})};let H=document.getElementById("root");H||(H=document.createElement("div"),H.id="root",document.body.appendChild(H));Ce(H).render(e.jsx(i.StrictMode,{children:e.jsxs(Ge,{client:Yt,children:[e.jsx(Ct,{theme:Qt,locale:Ut,children:e.jsx(Gt,{children:e.jsx(Js,{})})}),e.jsx(Ye,{initialIsOpen:!1})]})}));
